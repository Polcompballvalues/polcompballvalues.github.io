{"version":3,"names":["check_username","download_scores","parse_scores","play_error","play_success","player","send_message","send_scores","submissions","document","querySelector","scores","link","confirm","createElement","href","encodeURIComponent","JSON","stringify","download","click","load","style","display","loop","play","addEventListener","URLSearchParams","location","search","get","split","map","x","parseFloat","length","Error","every","user_name","trimmed_name","user","trim","prompt","controller","e","params","post_body","timeout","name","vals","error","console","alert","AbortController","setTimeout","abort","method","headers","signal","body","fetch","then","resp","clearTimeout","json","data","success","catch","err","getElementById","value","key","keyCode","preventDefault"],"sources":["..\\/src\\submitter.coffee"],"sourcesContent":["submissions = 0\r\n\r\nplayer = document.querySelector \"lottie-player\"\r\n\r\ndownload_scores = (scores) ->\r\n    if confirm \"Automatic submission of your scores failed, do you wish to download a copy of the scores to submit manually to the developers?\"\r\n        link = document.createElement \"a\"\r\n        link.href = \"data:text/json;charset=utf-8,\" + \\\r\n        encodeURIComponent(JSON.stringify(scores))\r\n        link.download = \"scores.json\"\r\n        do link.click\r\n\r\nplay_success = ->\r\n    player.load \"./assets/85185-checkmark.json\"\r\n    player.style.display = \"block\"\r\n    player.loop = false\r\n    do player.play\r\n    player.addEventListener \"complete\", ->\r\n        player.style.display = \"none\"\r\n\r\nplay_error = (scores) ->\r\n    player.load \"./assets/94303-failed.json\"\r\n    player.style.display = \"block\"\r\n    player.loop = false\r\n    do player.play\r\n    player.addEventListener \"complete\", ->\r\n        player.style.display = \"none\"\r\n        download_scores scores\r\n\r\nparse_scores = ->\r\n    url_pars = new URLSearchParams document.location.search\r\n\r\n    raw_scores = url_pars.get(\"score\") or \"\"\r\n    scores = raw_scores.split(\",\").map((x) -> parseFloat(x))\r\n    \r\n    if scores.length isnt 14\r\n        throw new Error \"Invalid scores\"\r\n\r\n    if not scores.every (x) -> x >= 0 and x <= 100\r\n        throw new Error \"Invalid scores\"\r\n    \r\n    return scores\r\n\r\ncheck_username = (user_name) ->\r\n    trimmed_name = do user_name.trim\r\n    if trimmed_name is null or trimmed_name is undefined or trimmed_name is \"\"\r\n        user = prompt \"You did not enter a username, please enter one and submit.\"\r\n        return check_username(user)\r\n    else\r\n        return user_name\r\n\r\nsend_scores = (user_name) ->\r\n    try\r\n        post_body = {\r\n            name: user_name\r\n            vals: do parse_scores\r\n        }\r\n\r\n    catch e\r\n        console.error e\r\n        alert e\r\n        return\r\n\r\n    controller = new AbortController()\r\n    timeout = setTimeout (-> do controller.abort), 10000\r\n\r\n    params = {\r\n        method : \"POST\"\r\n        headers : { \"Content-Type\": \"application/json; charset=utf-8\" }\r\n        signal : controller.signal\r\n        body : JSON.stringify post_body\r\n    }\r\n\r\n    player.load \"./assets/124239-loading-bouncy.json\"\r\n    player.style.display = \"block\"\r\n    player.loop = true\r\n    do player.play\r\n\r\n    fetch(\"https://pcbval.theghostofinky.repl.co/api/\", params)\r\n        .then (resp) ->\r\n            clearTimeout timeout\r\n            do resp.json\r\n        \r\n        .then (data) ->\r\n            if data.success\r\n                submissions++\r\n                do play_success\r\n            else \r\n                play_error post_body\r\n        \r\n        .catch (err) ->\r\n            console.error err\r\n            play_error post_body\r\n\r\nsend_message = ->\r\n    user_name = document.getElementById(\"name\").value.trim()\r\n    if submissions > 0\r\n        if confirm \"You already submitted your scores, do you wish to submit a new time?\"\r\n            user = check_username user_name \r\n            send_scores user\r\n    else\r\n        user = check_username user_name\r\n        if confirm \"Do you confirm you wish to submit your scores under the name of \\\"#{user}\\\"?\"\r\n            send_scores user\r\n\r\n\r\ndocument.getElementById(\"name\").addEventListener \"keydown\", (key) ->\r\n    if key.keyCode is 13\r\n        do key.preventDefault\r\n        do send_message\r\n    \r\ndocument.getElementById(\"send-button\").addEventListener \"click\", ->\r\n    do send_message"],"mappings":"AAAA,IAAAA,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,IAAc,EAEdH,EAASI,SAASC,cAAc,iBAEhCT,EAAmBU,IACnB,IAAAC,EAAI,GAAGC,QAAQ,kI,OACPD,EAAOH,SAASK,cAAc,MACzBC,KAAO,gCACZC,mBAAmBC,KAAKC,UAAUP,IAClCC,EAAKO,SAAW,cACbP,EAAKQ,OANE,EAQlBhB,EAAe,KACXC,EAAOgB,KAAK,iCACZhB,EAAOiB,MAAMC,QAAU,QACvBlB,EAAOmB,MAAO,EACXnB,EAAOoB,OACVpB,EAAOqB,iBAAiB,YAAY,IAChCrB,EAAOiB,MAAMC,QAAU,UAE/BpB,EAAcQ,IACVN,EAAOgB,KAAK,8BACZhB,EAAOiB,MAAMC,QAAU,QACvBlB,EAAOmB,MAAO,EACXnB,EAAOoB,OACVpB,EAAOqB,iBAAiB,YAAY,KAChCrB,EAAOiB,MAAMC,QAAU,OACvBtB,EAAgBU,OAExBT,EAAe,KACf,IAAAS,EAKI,GAAsB,MAFtBA,GAHW,IAAIgB,gBAAgBlB,SAASmB,SAASC,QAE3BC,IAAI,UAAY,IAClBC,MAAM,KAAKC,KAAKC,GAAMC,WAAWD,MAE3CE,OACN,MAAUC,MAAM,kBAEpB,IAAOzB,EAAO0B,OAAOJ,GAAMA,GAAK,GAAMA,GAAK,MACvC,MAAUG,MAAM,kBAEpB,OAAOzB,CAZI,EAcfX,EAAkBsC,IAClB,IAAAC,EAAAC,EACI,OAAGD,OADHA,EAAkBD,EAAUG,SAC4C,KAAhBF,GACpDC,EAAOE,OAAO,8DACP1C,EAAewC,IAEfF,CANE,EAQjB/B,EAAe+B,IACf,IAAAK,EAAAC,EAAAC,EAAAC,EAAAC,EAAI,IACID,EAAY,CACRE,KAAMV,EACNW,KAAS/C,I,CAGjB,MAAAgD,GAGI,OAFAC,QAAQD,MADNN,EAAAM,QAEFE,MAAMR,E,QAGVD,EAAa,IAAIU,gBACjBN,EAAUO,YAAW,IAAOX,EAAWY,SAAQ,KAE/CV,EAAS,CACLW,OAAS,OACTC,QAAU,CAAE,eAAgB,mCAC5BC,OAASf,EAAWe,OACpBC,KAAO1C,KAAKC,UAAU4B,IAG1BzC,EAAOgB,KAAK,uCACZhB,EAAOiB,MAAMC,QAAU,QACvBlB,EAAOmB,MAAO,EACXnB,EAAOoB,OAEVmC,MAAM,6CAA8Cf,GAC/CgB,MAAMC,IACHC,aAAahB,GACVe,EAAKE,UAEXH,MAAMI,GACAA,EAAKC,SACJ1D,IACGJ,KAEHD,EAAW2C,KAElBqB,OAAOC,IACJjB,QAAQD,MAAMkB,GACdjE,EAAW2C,KAzCT,EA2CdxC,EAAe,KACf,IAAAkC,EAAAF,EACI,GADAA,EAAY7B,SAAS4D,eAAe,QAAQC,MAAM7B,OAC/CjC,EAAc,GACb,GAAGK,QAAQ,wE,OACP2B,EAAOxC,EAAesC,GACtB/B,EAAYiC,QAGhB,GADAA,EAAOxC,EAAesC,GACnBzB,QAAQ,oEAAqE2B,O,OAC5EjC,EAAYiC,EATT,EAYf/B,SAAS4D,eAAe,QAAQ3C,iBAAiB,WAAY6C,IACzD,GAAkB,KAAfA,EAAIC,Q,OACAD,EAAIE,iBACJnE,GAHiD,IAK5DG,SAAS4D,eAAe,eAAe3C,iBAAiB,SAAS,IAC1DpB"}