{"version":3,"names":["check_username","download_scores","lock","parse_scores","play_error","play_success","player","send_message","send_scores","submissions","document","querySelector","scores","link","confirm","createElement","href","encodeURIComponent","JSON","stringify","download","click","listener","load","style","display","loop","play","removeEventListener","addEventListener","URLSearchParams","location","search","get","split","map","x","parseFloat","length","Error","every","user_name","trimmed_name","user","trim","prompt","controller","e","params","post_body","timeout","name","vals","error","console","alert","AbortController","setTimeout","abort","method","headers","signal","body","fetch","then","resp","clearTimeout","json","data","success","catch","err","getElementById","value","key","keyCode","preventDefault"],"sources":["..\\/src\\coffeescript\\submitter.coffee"],"sourcesContent":["lock = false\r\nsubmissions = 0\r\n\r\nplayer = document.querySelector \"lottie-player\"\r\n\r\ndownload_scores = (scores) ->\r\n    if confirm \"Automatic submission of your scores failed, do you wish to download a copy of the scores to submit manually to the developers?\"\r\n        link = document.createElement \"a\"\r\n        link.href = \"data:text/json;charset=utf-8,\" + \\\r\n            encodeURIComponent JSON.stringify scores\r\n        link.download = \"scores.json\"\r\n        do link.click\r\n\r\nplay_success = ->\r\n    player.load \"./assets/85185-checkmark.json\"\r\n    player.style.display = \"block\"\r\n    player.loop = false\r\n    do player.play\r\n\r\n    listener = ->\r\n        player.style.display = \"none\"\r\n        player.removeEventListener \"complete\", listener\r\n\r\n    player.addEventListener \"complete\", listener\r\n\r\nplay_error = (scores) ->\r\n    player.load \"./assets/94303-failed.json\"\r\n    player.style.display = \"block\"\r\n    player.loop = false\r\n    do player.play\r\n    \r\n    listener = ->\r\n        player.style.display = \"none\"\r\n        download_scores scores\r\n        player.removeEventListener \"complete\", listener\r\n    \r\n    player.addEventListener \"complete\", listener\r\n\r\n        \r\n\r\nparse_scores = ->\r\n    url_pars = new URLSearchParams document.location.search\r\n\r\n    raw_scores = url_pars.get(\"score\") or \"\"\r\n    scores = raw_scores.split(\",\").map (x) -> parseFloat x\r\n    \r\n    if scores.length isnt 14\r\n        throw new Error \"Invalid scores\"\r\n\r\n    if not scores.every (x) -> x >= 0 and x <= 100\r\n        throw new Error \"Invalid scores\"\r\n    \r\n    return scores\r\n\r\ncheck_username = (user_name) ->\r\n    trimmed_name = do user_name.trim\r\n    if trimmed_name is null or trimmed_name is undefined or trimmed_name is \"\"\r\n        user = prompt \"You did not enter a username, please enter one and submit.\"\r\n        return check_username user\r\n    else\r\n        return user_name\r\n\r\nsend_scores = (user_name) ->\r\n    try\r\n        post_body = {\r\n            name: user_name\r\n            vals: do parse_scores\r\n        }\r\n\r\n    catch e\r\n        console.error e\r\n        alert e\r\n        return\r\n\r\n    controller = new AbortController\r\n    timeout = setTimeout (-> do controller.abort), 10000\r\n\r\n    params = {\r\n        method : \"POST\"\r\n        headers : { \"Content-Type\": \"application/json; charset=utf-8\" }\r\n        signal : controller.signal\r\n        body : JSON.stringify post_body\r\n    }\r\n\r\n    player.load \"./assets/124239-loading-bouncy.json\"\r\n    player.style.display = \"block\"\r\n    player.loop = true\r\n    do player.play\r\n\r\n    fetch(\"https://pcbval.theghostofinky.repl.co/api/\", params)\r\n        .then (resp) ->\r\n            clearTimeout timeout\r\n            lock = false\r\n            do resp.json\r\n        \r\n        .then (data) ->\r\n            if data.success\r\n                submissions++\r\n                do play_success\r\n            else \r\n                play_error post_body\r\n        \r\n        .catch (err) ->\r\n            clearTimeout timeout\r\n            lock = false\r\n            console.error err\r\n            play_error post_body\r\n\r\nsend_message = ->\r\n    if lock\r\n        return\r\n    lock = true\r\n    user_name = do document.getElementById(\"name\").value.trim\r\n    if submissions > 0\r\n        if confirm \"You already submitted your scores, do you wish to submit a new time?\"\r\n            user = check_username user_name \r\n            send_scores user\r\n    else\r\n        user = check_username user_name\r\n        if confirm \"Do you confirm you wish to submit your scores under the name of \\\"#{user}\\\"?\"\r\n            send_scores user\r\n\r\n\r\ndocument.getElementById(\"name\").addEventListener \"keydown\", (key) ->\r\n    if key.keyCode is 13\r\n        do key.preventDefault\r\n        do send_message\r\n    \r\ndocument.getElementById(\"send-button\").addEventListener \"click\", ->\r\n    do send_message"],"mappings":"AAAA,IAAAA,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAP,GAAO,EACPO,EAAc,EAEdH,EAASI,SAASC,cAAc,iBAEhCV,EAAmBW,IACnB,IAAAC,EAAI,GAAGC,QAAQ,kI,OACPD,EAAOH,SAASK,cAAc,MACzBC,KAAO,gCACRC,mBAAmBC,KAAKC,UAAUP,IACtCC,EAAKO,SAAW,cACbP,EAAKQ,OANE,EAQlBhB,EAAe,KACf,IAAAiB,E,OAAIhB,EAAOiB,KAAK,iCACZjB,EAAOkB,MAAMC,QAAU,QACvBnB,EAAOoB,MAAO,EACXpB,EAAOqB,OAEVL,EAAW,KACPhB,EAAOkB,MAAMC,QAAU,OACvBnB,EAAOsB,oBAAoB,WAAYN,IAE3ChB,EAAOuB,iBAAiB,WAAYP,EAVzB,EAYflB,EAAcQ,IACd,IAAAU,E,OAAIhB,EAAOiB,KAAK,8BACZjB,EAAOkB,MAAMC,QAAU,QACvBnB,EAAOoB,MAAO,EACXpB,EAAOqB,OAEVL,EAAW,KACPhB,EAAOkB,MAAMC,QAAU,OACvBxB,EAAgBW,GAChBN,EAAOsB,oBAAoB,WAAYN,IAE3ChB,EAAOuB,iBAAiB,WAAYP,EAX3B,EAebnB,EAAe,KACf,IAAAS,EAKI,GAAsB,MAFtBA,GAHW,IAAIkB,gBAAgBpB,SAASqB,SAASC,QAE3BC,IAAI,UAAY,IAClBC,MAAM,KAAKC,KAAKC,GAAMC,WAAWD,MAE3CE,OACN,MAAUC,MAAM,kBAEpB,IAAO3B,EAAO4B,OAAOJ,GAAMA,GAAK,GAAMA,GAAK,MACvC,MAAUG,MAAM,kBAEpB,OAAO3B,CAZI,EAcfZ,EAAkByC,IAClB,IAAAC,EAAAC,EACI,OAAGD,OADHA,EAAkBD,EAAUG,SAC4C,KAAhBF,GACpDC,EAAOE,OAAO,8DACP7C,EAAe2C,IAEfF,CANE,EAQjBjC,EAAeiC,IACf,IAAAK,EAAAC,EAAAC,EAAAC,EAAAC,EAAI,IACID,EAAY,CACRE,KAAMV,EACNW,KAASjD,I,CAGjB,MAAAkD,GAGI,OAFAC,QAAQD,MADNN,EAAAM,QAEFE,MAAMR,E,QAGVD,EAAa,IAAIU,gBACjBN,EAAUO,YAAW,IAAOX,EAAWY,SAAQ,KAE/CV,EAAS,CACLW,OAAS,OACTC,QAAU,CAAE,eAAgB,mCAC5BC,OAASf,EAAWe,OACpBC,KAAO5C,KAAKC,UAAU8B,IAG1B3C,EAAOiB,KAAK,uCACZjB,EAAOkB,MAAMC,QAAU,QACvBnB,EAAOoB,MAAO,EACXpB,EAAOqB,OAEVoC,MAAM,6CAA8Cf,GAC/CgB,MAAMC,IACHC,aAAahB,GACbhD,GAAO,EACJ+D,EAAKE,UAEXH,MAAMI,GACAA,EAAKC,SACJ5D,IACGJ,KAEHD,EAAW6C,KAElBqB,OAAOC,IACJL,aAAahB,GACbhD,GAAO,EACPoD,QAAQD,MAAMkB,GACdnE,EAAW6C,KA5CT,EA8Cd1C,EAAe,KACf,IAAAoC,EAAAF,EAAI,IAAGvC,EAIH,GAFAA,GAAO,EACPuC,EAAe/B,SAAS8D,eAAe,QAAQC,MAAM7B,OAClDnC,EAAc,GACb,GAAGK,QAAQ,wE,OACP6B,EAAO3C,EAAeyC,GACtBjC,EAAYmC,QAGhB,GADAA,EAAO3C,EAAeyC,GACnB3B,QAAQ,oEAAqE6B,O,OAC5EnC,EAAYmC,EAZT,EAefjC,SAAS8D,eAAe,QAAQ3C,iBAAiB,WAAY6C,IACzD,GAAkB,KAAfA,EAAIC,Q,OACAD,EAAIE,iBACJrE,GAHiD,IAK5DG,SAAS8D,eAAe,eAAe3C,iBAAiB,SAAS,IAC1DtB"}