{"version":3,"names":["check_username","parse_scores","play_error","play_success","player","send_message","send_scores","submissions","document","querySelector","load","style","display","play","addEventListener","scores","URLSearchParams","location","search","get","split","map","x","parseFloat","length","Error","every","user_name","trimmed_name","user","trim","prompt","controller","params","post_body","timeout","name","vals","AbortController","setTimeout","abort","method","headers","signal","body","JSON","stringify","fetch","then","resp","clearTimeout","json","data","success","catch","err","console","error","getElementById","value","confirm","key","keyCode","preventDefault"],"sources":["../src/submitter.coffee"],"sourcesContent":["submissions = 0\r\n\r\nplayer = document.querySelector \"lottie-player\"\r\n\r\nplay_success = ->\r\n    player.load \"./assets/85185-checkmark.json\"\r\n    player.style.display = \"block\"\r\n    do player.play\r\n    player.addEventListener \"complete\", ->\r\n        player.style.display = \"none\"\r\n\r\nplay_error = ->\r\n    player.load \"./assets/94303-failed.json\"\r\n    player.style.display = \"block\"\r\n    do player.play\r\n    player.addEventListener \"complete\", ->\r\n        player.style.display = \"none\"\r\n\r\nparse_scores = ->\r\n    url_pars = new URLSearchParams document.location.search\r\n\r\n    scores = url_pars.get(\"score\").split(\",\").map((x) -> parseFloat(x))\r\n    \r\n    if scores.length is not 14\r\n        throw new Error \"Invalid scores\"\r\n\r\n    if not scores.every (x) -> x >= 0 and x <= 100\r\n        throw new Error \"Invalid scores\"\r\n    \r\n    return scores\r\n\r\ncheck_username = (user_name) ->\r\n    trimmed_name = do user_name.trim\r\n    if trimmed_name is null or trimmed_name is undefined or trimmed_name is \"\"\r\n        user = prompt \"You did not enter a username, please enter one and submit.\"\r\n        return check_username(user)\r\n    else\r\n        return user_name\r\n\r\nsend_scores = (user_name) ->\r\n    post_body = {\r\n        name: user_name\r\n        vals: do parse_scores\r\n    }\r\n\r\n    controller = new AbortController()\r\n    timeout = setTimeout (-> do controller.abort), 10000\r\n\r\n    params = {\r\n        method : \"POST\"\r\n        headers : { \"Content-Type\": \"application/json; charset=utf-8\" }\r\n        signal : controller.signal\r\n        body : JSON.stringify post_body\r\n    }\r\n\r\n    fetch(\"https://pcbval.theghostofinky.repl.co/api/\", params)\r\n        .then (resp) ->\r\n            clearTimeout timeout\r\n            do resp.json\r\n        \r\n        .then (data) ->\r\n            if data.success\r\n                submissions++\r\n                do play_success\r\n            else \r\n                do play_error\r\n        \r\n        .catch (err) ->\r\n            console.error err\r\n            do play_error\r\n\r\nsend_message = ->\r\n    user_name = document.getElementById(\"name\").value.trim()\r\n    if submissions > 0\r\n        if confirm \"You already submitted your scores, do you wish to submit a new time?\"\r\n            user = check_username user_name \r\n            send_scores user\r\n    else\r\n        user = check_username user_name\r\n        if confirm \"Do you confirm you wish to submit your scores under the name of \\\"#{user}\\\"?\"\r\n            send_scores user\r\n\r\n\r\ndocument.getElementById(\"name\").addEventListener \"keydown\", (key) ->\r\n    if key.keyCode is 13\r\n        do key.preventDefault\r\n        do send_message\r\n    \r\ndocument.getElementById(\"send-button\").addEventListener \"click\", ->\r\n    do send_message"],"mappings":"AAAA,IAAAA,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,IAAc,EAEdH,EAASI,SAASC,cAAc,iBAEhCN,EAAe,KACXC,EAAOM,KAAK,iCACZN,EAAOO,MAAMC,QAAU,QACpBR,EAAOS,OACVT,EAAOU,iBAAiB,YAAY,IAChCV,EAAOO,MAAMC,QAAU,UAE/BV,EAAa,KACTE,EAAOM,KAAK,8BACZN,EAAOO,MAAMC,QAAU,QACpBR,EAAOS,OACVT,EAAOU,iBAAiB,YAAY,IAChCV,EAAOO,MAAMC,QAAU,UAE/BX,EAAe,KACf,IAAAc,EAII,IAAoB,KAFpBA,EAFW,IAAIC,gBAAgBR,SAASS,SAASC,QAE/BC,IAAI,SAASC,MAAM,KAAKC,KAAKC,GAAMC,WAAWD,MAEtDE,OACN,MAAUC,MAAM,kBAEpB,IAAOV,EAAOW,OAAOJ,GAAMA,GAAK,GAAMA,GAAK,MACvC,MAAUG,MAAM,kBAEpB,OAAOV,CAXI,EAaff,EAAkB2B,IAClB,IAAAC,EAAAC,EACI,OAAGD,OADHA,EAAkBD,EAAUG,SAC4C,KAAhBF,GACpDC,EAAOE,OAAO,8DACP/B,EAAe6B,IAEfF,CANE,EAQjBrB,EAAeqB,IACf,IAAAK,EAAAC,EAAAC,EAAAC,E,OAAID,EAAY,CACRE,KAAMT,EACNU,KAASpC,KAGb+B,EAAa,IAAIM,gBACjBH,EAAUI,YAAW,IAAOP,EAAWQ,SAAQ,KAE/CP,EAAS,CACLQ,OAAS,OACTC,QAAU,CAAE,eAAgB,mCAC5BC,OAASX,EAAWW,OACpBC,KAAOC,KAAKC,UAAUZ,IAG1Ba,MAAM,6CAA8Cd,GAC/Ce,MAAMC,IACHC,aAAaf,GACVc,EAAKE,UAEXH,MAAMI,GACAA,EAAKC,SACJ9C,IACGJ,KAEAD,MAEVoD,OAAOC,IACJC,QAAQC,MAAMF,GACXrD,MA9BD,EAgCdG,EAAe,KACf,IAAAwB,EAAAF,EACI,GADAA,EAAYnB,SAASkD,eAAe,QAAQC,MAAM7B,OAC/CvB,EAAc,GACb,GAAGqD,QAAQ,wE,OACP/B,EAAO7B,EAAe2B,GACtBrB,EAAYuB,QAGhB,GADAA,EAAO7B,EAAe2B,GACnBiC,QAAQ,oEAAqE/B,O,OAC5EvB,EAAYuB,EATT,EAYfrB,SAASkD,eAAe,QAAQ5C,iBAAiB,WAAY+C,IACzD,GAAkB,KAAfA,EAAIC,Q,OACAD,EAAIE,iBACJ1D,GAHiD,IAK5DG,SAASkD,eAAe,eAAe5C,iBAAiB,SAAS,IAC1DT"}