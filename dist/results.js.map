{"version":3,"names":["bg","canvas","canvas_elm","edition_raw","elm","fg","i","ind","j","k","l","len","len1","len2","m","onload_render","order_scores","other_matches","params","ref","ref1","score","scores","scores_raw","scr","scr_key","set_bar_value","url_pars","users","val","val_names","values","weights","getJson","Canvas","name","value","innerel","document","getElementById","style","width","toFixed","innerHTML","display","finalscore","raw_delta","sum","user","length","Object","keys","Math","abs","stats","pow","push","sort","a","b","URLSearchParams","location","search","get","split","reduce","obj","parseFloat","Error","every","x","Array","fill","textContent","createElement","appendChild","edition","version","window","VERSION","matchMedia","matches","drawValues","drawValueBg","tiers","findTier","labels","drawScoreRect","addEventListener","href","map","join","len3","n","ref2","drawScoreLabel","drawHeader","setTimeout","event","createEvent","initEvent","dispatchEvent"],"sources":["..\\/src\\results.coffee"],"sourcesContent":["import {getJson, Canvas} from \"./common.js\"\r\n\r\nset_bar_value = (name, value) ->\r\n    innerel = document.getElementById(\"span-\" + name)\r\n    outerel = document.getElementById(\"bar-\" + name)\r\n    outerel.style.width = value.toFixed(1) + \"%\"\r\n    innerel.innerHTML = value.toFixed(1) + \"%\"\r\n    if value < 20\r\n        innerel.style.display = \"none\"\r\n    else\r\n        innerel.style.display = \"block\"\r\n\r\norder_scores = (scores, weights, users) ->\r\n    finalscore = []\r\n    for user,ind in users\r\n        sum = 0\r\n        for scr,ind in Object.keys scores\r\n            raw_delta = Math.abs scores[scr] - user.stats[scr]\r\n            sum += weights[ind] * Math.pow(raw_delta/100, 3)\r\n        finalscore.push {\r\n            name : user.name\r\n            score: sum/weights.length\r\n        }\r\n    finalscore.sort (a,b) -> \r\n        a.score - b.score\r\n\r\nval_names = [\"spos\",\"alle\",\"expr\",\"pers\",\"horn\",\"fame\",\"shwr\",\"sani\",\"rela\",\"fedp\",\"actn\",\"purp\",\"perc\",\"cmdy\"]\r\n\r\nurl_pars = new URLSearchParams document.location.search\r\n\r\nscores_raw = url_pars.get \"score\"\r\nedition_raw = url_pars.get \"edition\"\r\n\r\nscores = scores_raw.split(\",\").reduce( \r\n    ((obj,val,ind) -> \r\n        { ...obj, [val_names[ind]] : parseFloat(val)}\r\n    ),{})\r\n\r\nif Object.keys(scores).length is not val_names.length\r\n    throw new Error \"Invalid scores\"\r\n\r\nif not Object.values(scores).every (x) -> x >= 0 and x <= 100\r\n    throw new Error \"Invalid scores\"\r\n\r\nweights = new Array(14).fill(2)\r\nvalues = await getJson \"values\"\r\nusers = order_scores scores,weights,await getJson \"users\"\r\n\r\ndocument.getElementById(\"cmatch\").textContent = users[0].name + \\\r\n    \": \" + ((1 - users[0].score)*100).toFixed(1) + \"%\"\r\n\r\nother_matches = document.getElementById(\"other-matches\")\r\nfor i in [1..5]\r\n    do(i) ->    \r\n        elm = document.createElement \"p\"\r\n        elm.textContent = users[i].name + \": \" +\\ \r\n        ((1 - users[i].score)*100).toFixed(1) + \"%\"\r\n        other_matches.appendChild elm\r\n\r\nparams =\r\n    edition: if edition_raw is \"s\" then \"Short test\" else \"Full test\"\r\n    user: users[0].name\r\n    version: window.VERSION\r\n\r\ncanvas_elm = document.getElementById \"banner\"\r\n[bg,fg] = if window.matchMedia(\"(prefers-color-scheme: dark)\").matches \\\r\n    then [\"#333\",\"#EEE\"] else [\"#EEE\",\"#333\"]\r\n\r\ncanvas = new Canvas canvas_elm,1860,800,fg,bg\r\n\r\nfor val,ind in values\r\n    canvas.drawValues val,ind\r\n    canvas.drawValueBg ind\r\n    elm = document.getElementById val.name + \"-label\"\r\n    scr_key = Object.keys(scores)[ind]\r\n    score = scores[scr_key]\r\n    elm.textContent = val.tiers[Canvas.findTier score]\r\n    for lab,ind in val.labels\r\n        set_bar_value lab, (if ind then 100 - score else score)\r\n\r\nfor scr,ind in Object.keys scores\r\n    canvas.drawScoreRect scores,values,scr,ind\r\n\r\ndocument.getElementById(\"submit-button\").addEventListener \"click\", ->\r\n    location.href = \"submitter.html?score=\" + Object.values(scores).map((x)->x.toFixed 1).join \",\"\r\n\r\nonload_render = -> \r\n    for scr,ind in Object.keys scores\r\n        canvas.drawScoreLabel scores[scr],values,ind\r\n\r\n    canvas.drawHeader params\r\n\r\n\r\nsetTimeout (->\r\n    event = document.createEvent \"Event\"\r\n    event.initEvent \"load\", false, false\r\n    window.dispatchEvent event\r\n    onload_render()\r\n    ), 300\r\n\r\n"],"mappings":"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"}