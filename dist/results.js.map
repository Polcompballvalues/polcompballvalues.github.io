{"version":3,"names":["bg","canvas","canvas_elm","edition_raw","elm","err","fg","i","ind","is_valid","j","k","l","len","len1","len2","m","onload_render","order_scores","other_matches","params","ref","ref1","score","scores","scores_raw","scr","scr_key","set_bar_value","url_pars","users","val","val_names","valid_scores","values","weights","getJson","Canvas","name","value","innerel","document","getElementById","style","width","toFixed","innerHTML","display","finalscore","raw_delta","sum","user","length","Object","keys","Math","abs","stats","pow","push","sort","a","b","some","x","every","URLSearchParams","location","search","get","split","reduce","obj","parseFloat","addEventListener","href","map","join","alert","Error","Array","fill","textContent","createElement","appendChild","edition","version","window","VERSION","matchMedia","matches","drawValues","drawValueBg","tiers","findTier","labels","drawScoreRect","len3","n","ref2","drawScoreLabel","drawHeader","setTimeout","event","createEvent","initEvent","dispatchEvent"],"sources":["..\\/src\\results.coffee"],"sourcesContent":["import {getJson, Canvas} from \"./common.js\"\r\n\r\nvalid_scores = true\r\n\r\nset_bar_value = (name, value) ->\r\n    innerel = document.getElementById(\"span-\" + name)\r\n    outerel = document.getElementById(\"bar-\" + name)\r\n    outerel.style.width = value.toFixed(1) + \"%\"\r\n    innerel.innerHTML = value.toFixed(1) + \"%\"\r\n    if value < 20\r\n        innerel.style.display = \"none\"\r\n    else\r\n        innerel.style.display = \"block\"\r\n\r\norder_scores = (scores, weights, users) ->\r\n    finalscore = []\r\n    for user,ind in users\r\n        sum = 0\r\n        for scr,ind in Object.keys scores\r\n            raw_delta = Math.abs scores[scr] - user.stats[scr]\r\n            sum += weights[ind] * Math.pow(raw_delta/100, 3)\r\n        finalscore.push {\r\n            name : user.name\r\n            score: sum/weights.length\r\n        }\r\n    finalscore.sort (a,b) -> \r\n        a.score - b.score\r\n\r\nis_valid = (scores) ->\r\n    if not (Object.keys(scores).length is val_names.length)\r\n        return false\r\n\r\n    if Object.values(scores).some (x) -> x is undefined\r\n        return false\r\n\r\n    if not Object.values(scores).every (x) -> x >= 0 and x <= 100\r\n        return false\r\n\r\n    true\r\n\r\n\r\nval_names = [\"spos\",\"alle\",\"expr\",\"pers\",\"horn\",\"fame\",\"shwr\",\"sani\",\"rela\",\"fedp\",\"actn\",\"purp\",\"perc\",\"cmdy\"]\r\n\r\nurl_pars = new URLSearchParams document.location.search\r\n\r\nscores_raw = url_pars.get \"score\" or \"\"\r\nedition_raw = url_pars.get \"edition\"\r\n\r\nscores = scores_raw.split(\",\").reduce( \r\n    ((obj,val,ind) -> \r\n        { ...obj, [val_names[ind]] : parseFloat(val)}\r\n    ),{})\r\n\r\ndocument.getElementById(\"submit-button\").addEventListener \"click\", ->\r\n    if valid_scores\r\n        location.href = \"submitter.html?score=\" + Object.values(scores).map((x)->x.toFixed 1).join \",\"\r\n    else\r\n        alert err\r\n\r\nif not is_valid scores\r\n    valid_scores = false\r\n    err = \"Invalid scores\"\r\n    alert err\r\n    throw new Error err\r\n\r\n\r\nweights = new Array(14).fill(2)\r\nvalues = await getJson \"values\"\r\nusers = order_scores scores,weights,await getJson \"users\"\r\n\r\ndocument.getElementById(\"cmatch\").textContent = users[0].name + \\\r\n    \": \" + ((1 - users[0].score)*100).toFixed(1) + \"%\"\r\n\r\nother_matches = document.getElementById(\"other-matches\")\r\nfor i in [1..5]\r\n    do(i) ->    \r\n        elm = document.createElement \"p\"\r\n        elm.textContent = users[i].name + \": \" +\\ \r\n        ((1 - users[i].score)*100).toFixed(1) + \"%\"\r\n        other_matches.appendChild elm\r\n\r\nparams =\r\n    edition: if edition_raw is \"s\" then \"Short test\" else \"Full test\"\r\n    user: users[0].name\r\n    version: window.VERSION\r\n\r\ncanvas_elm = document.getElementById \"banner\"\r\n[bg,fg] = if window.matchMedia(\"(prefers-color-scheme: dark)\").matches \\\r\n    then [\"#333\",\"#EEE\"] else [\"#EEE\",\"#333\"]\r\n\r\ncanvas = new Canvas canvas_elm,1860,800,fg,bg\r\n\r\nfor val,ind in values\r\n    canvas.drawValues val,ind\r\n    canvas.drawValueBg ind\r\n    elm = document.getElementById val.name + \"-label\"\r\n    scr_key = Object.keys(scores)[ind]\r\n    score = scores[scr_key]\r\n    elm.textContent = val.tiers[Canvas.findTier score]\r\n    for lab,ind in val.labels\r\n        set_bar_value lab, (if ind then 100 - score else score)\r\n\r\nfor scr,ind in Object.keys scores\r\n    canvas.drawScoreRect scores,values,scr,ind\r\n\r\n\r\nonload_render = ->\r\n    if valid_scores\r\n        for scr,ind in Object.keys scores\r\n            canvas.drawScoreLabel scores[scr],values,ind\r\n\r\n        canvas.drawHeader params\r\n\r\n\r\nsetTimeout (->\r\n    event = document.createEvent \"Event\"\r\n    event.initEvent \"load\", false, false\r\n    window.dispatchEvent event\r\n    onload_render()\r\n    ), 300\r\n\r\n"],"mappings":"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"}