var e,t,n,r,a,o,l,s,c,d,m,i,u,h,p,g,w,E,b,v,y,f,j,k,I,x,B,O,F,L,S,C,M,R,T,V;import{getJson as H,Canvas as U}from"./common.js";if(R=!0,F=(e,t)=>{var n;return n=document.getElementById("span-"+e),document.getElementById("bar-"+e).style.width=t.toFixed(1)+"%",n.innerHTML=t.toFixed(1)+"%",n.style.display=t<20?"none":"block"},b=(e,t,n)=>{var r,a,o,l,s,c,d,m,i,u,h;for(r=[],a=o=0,s=n.length;o<s;a=++o){for(h=n[a],u=0,a=l=0,c=(m=Object.keys(e)).length;l<c;a=++l)i=m[a],d=Math.abs(e[i]-h.stats[i]),u+=t[a]*Math.pow(d/100,3);r.push({name:h.name,score:u/t.length})}return r.sort(((e,t)=>e.score-t.score))},d=e=>Object.keys(e).length===M.length&&(!Object.values(e).some((e=>void 0===e))&&!!Object.values(e).every((e=>e>=0&&e<=100))),M=["spos","alle","expr","pers","horn","fame","shwr","sani","rela","fedp","actn","purp","perc","cmdy"],x=(L=new URLSearchParams(document.location.search)).get("score")||"",r=L.get("edition"),I=x.split(",").reduce(((e,t,n)=>({...e,[M[n]]:parseFloat(t)})),{}),document.getElementById("submit-button").addEventListener("click",(()=>R?location.href="submitter.html?score="+Object.values(I).map((e=>e.toFixed(1))).join(","):alert(o))),!d(I))throw R=!1,o="Invalid scores",alert(o),Error(o);for(V=Array(14).fill(2),T=await H("values"),S=b(I,V,await H("users")),document.getElementById("cmatch").textContent=S[0].name+": "+(100*(1-S[0].score)).toFixed(1)+"%",v=document.getElementById("other-matches"),s=m=1;m<=5;s=++m)(e=>{var t;(t=document.createElement("p")).textContent=S[e].name+": "+(100*(1-S[e].score)).toFixed(1)+"%",v.appendChild(t)})(s);for(y={edition:"s"===r?"Short test":"Full test",user:S[0].name,version:window.VERSION},n=document.getElementById("banner"),[e,l]=window.matchMedia("(prefers-color-scheme: dark)").matches?["#333","#EEE"]:["#EEE","#333"],t=new U(n,1860,800,l,e),c=i=0,h=T.length;i<h;c=++i)for(C=T[c],t.drawValues(C,c),t.drawValueBg(c),a=document.getElementById(C.name+"-label"),O=Object.keys(I)[c],k=I[O],a.textContent=C.tiers[U.findTier(k)],f=C.labels,c=u=0,p=f.length;u<p;c=++u)F(f[c],c?100-k:k);for(c=w=0,g=(j=Object.keys(I)).length;w<g;c=++w)B=j[c],t.drawScoreRect(I,T,B,c);document.getElementById("download-button").addEventListener("click",(()=>{var e;return(e=document.createElement("a")).download="polcompballvalues.png",e.href=t.element.toDataURL("image/png"),e.click()})),E=()=>{var e,n,r;if(R){for(c=n=0,e=(r=Object.keys(I)).length;n<e;c=++n)B=r[c],t.drawScoreLabel(I[B],T,c);return t.drawHeader(y)}},setTimeout((()=>{var e;return e=new Event("load"),window.dispatchEvent(e),E()}),300);
//# sourceMappingURL=results.js.map